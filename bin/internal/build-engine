#!/usr/bin/env node

const esbuild = require("esbuild")
const fs = require("node:fs/promises")
const path = require("node:path")

const root = path.join(__dirname, "..", "..")

async function runUnsafe() {
  const apiDir = path.join(root, "src", "api")
  const listing = await fs.readdir(apiDir)
  await esbuild.build({
    entryPoints: listing.map(e => path.join(apiDir, e)),
    bundle: true,
    splitting: true,
    format: "esm",
    minify: true,
    sourcemap: true,
    outdir: path.join(root, "build", "api"),
  })
}

async function run() {
  try {
    await runUnsafe()
  } catch (e) {
    console.error(e)
    process.exit(1)
  }
}

void run()